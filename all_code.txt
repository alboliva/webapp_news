=== DUMP PROGETTO ===
Generato: 2026-01-08 10:29:36
Cartella: /Users/alberto.oliva/Library/CloudStorage/OneDrive-Accenture/projects/notebook/webapp_news


======================================================================
FILE: unisci_codice.py
======================================================================

# dump_rapido.py - versione minimalista e aggressiva
import os
from datetime import datetime

output_file = f"all_code.txt" #_{datetime.now().strftime('%Y%m%d_%H%M')}.txt"

with open(output_file, "w", encoding="utf-8") as out:
    out.write(f"=== DUMP PROGETTO ===\n")
    out.write(f"Generato: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
    out.write(f"Cartella: {os.getcwd()}\n\n")

    for root, dirs, files in os.walk("."):
        # salta cartelle fastidiose
        if '__pycache__' in root or '.git' in root or 'venv' in root:
            continue
            
        for file in files:
            if file.endswith(('.py', '.yaml', '.yml', '.txt', '.md', '.json')):
                path = os.path.join(root, file)
                rel_path = os.path.relpath(path, ".")
                
                out.write(f"\n{'='*70}\n")
                out.write(f"FILE: {rel_path}\n")
                out.write(f"{'='*70}\n\n")
                
                try:
                    with open(path, "r", encoding="utf-8") as f:
                        content = f.read()
                    out.write(content + "\n\n")
                except Exception as e:
                    out.write(f"ERRORE lettura: {e}\n\n")

    out.write("\n=== FINE ===\n")

print(f"Creato: {output_file}")
print(f"Dimensione: {os.path.getsize(output_file) / 1024:.1f} KB")


======================================================================
FILE: requirements.txt
======================================================================

streamlit>=1.40
streamlit-authenticator>=0.4.2
streamlit-autorefresh
feedparser               # per RSS
requests
newspaper3k              # opzionale per estrarre testo da articoli
sqlite3                  # built-in
# opzionale: groq         # se usi LLM per summary


======================================================================
FILE: news.txt
======================================================================

Congresso USA indaga su frode da 9 miliardi in programmi sociali Minnesota, legate a reti somale
https://pbs.twimg.com/media/G-EjZC5XMAAikZQ.jpg
L'House Oversight Committee ha tenuto un'udienza che ha rivelato una massiccia frode nei programmi sociali del Minnesota finanziati dal governo federale, con stime fino a 9 miliardi di dollari rubati da fondi per nutrizione infantile, servizi autismi, asili, alloggi e Medicaid. Legislatori repubblicani hanno accusato funzionari statali sotto il governatore Tim Walz di ignorare avvisi, silenziare whistleblower e mancare di controlli, permettendo schemi legati a reti somalo-americane.
Testimoni repubblicani del Minnesota hanno descritto segnalazioni di frode dal 2011 ignorate, con ritorsioni contro dipendenti. Procuratori federali hanno incriminato 98 persone, 85 di origine somala, con decine di condanne.
La frode piÃ¹ grande coinvolge Feeding Our Future, che ha rubato almeno 250 milioni fingendo di nutrire bambini. Walz e democratici sono accusati di negligenza per timore di alienare la comunitÃ  somala, base elettorale chiave. Walz difende le sue azioni e ha annunciato il 5 gennaio 2026 di non ricandidarsi.
Mancati controlli durante la pandemia e paure di accuse di razzismo hanno favorito gli schemi. Procuratori stimano che metÃ  dei 18 miliardi federali recenti sia fraudolenta, con imputati somalo-americani che compravano beni di lusso.
Reazioni: repubblicani come House GOP e Mario Nawfal enfatizzano fine delle frodi e procure aggiuntive da AG Pam Bondi. Josh Hawley propone un ispettore generale federale. Elon Musk chiede di perseguire Walz come facilitatore. Rep. Nancy Mace ha tentato di subpoena record immigratori di Ilhan Omar per accuse di matrimonio fraudolento (mozione respinta). Rep. Anna Paulina Luna ha riferito Walz e AG Keith Ellison al DOJ per complicitÃ .
Indagini federali continuano con sequestri e udienze future.
2026-01-08 10:45:00



======================================================================
FILE: all_code.txt
======================================================================




======================================================================
FILE: app.py
======================================================================

import streamlit as st
from streamlit_autorefresh import st_autorefresh
from datetime import datetime, date, timedelta
import os

# -------------------------------
# CONFIG
REFRESH_INTERVAL_MS = 300000  # 5 minuti
ARCHIVE_DIR = "archive"
st.set_page_config(page_title="Notizie in Sintesi", layout="wide")

# Crea cartella archive se non esiste
if not os.path.exists(ARCHIVE_DIR):
    os.makedirs(ARCHIVE_DIR)

# Mesi e giorni in italiano
MONTHS_IT = ["Gen", "Feb", "Mar", "Apr", "Mag", "Giu", "Lug", "Ago", "Set", "Ott", "Nov", "Dic"]
WEEKDAYS_IT = ["Lun", "Mar", "Mer", "Gio", "Ven", "Sab", "Dom"]

# Formatta data come "07 Gen, 17.45"
def format_update_time(dt_str):
    try:
        dt = datetime.strptime(dt_str, "%Y-%m-%d %H:%M:%S")
        return f"{dt.day:02d} {MONTHS_IT[dt.month-1]}, {dt.hour:02d}.{dt.minute:02d}"
    except:
        return dt_str

# -------------------------------
# Funzione per caricare notizie (robusta)
def load_news(file_path):
    if not os.path.exists(file_path):
        return None

    news_list = []
    try:
        with open(file_path, "r", encoding="utf-8") as f:
            lines = [line.rstrip() for line in f.readlines()]
    except Exception as e:
        st.error(f"Errore lettura file {file_path}: {e}")
        return []

    i = 0
    while i < len(lines):
        while i < len(lines) and not lines[i].strip():
            i += 1
        if i >= len(lines):
            break

        title = lines[i].strip()
        i += 1

        while i < len(lines) and not lines[i].strip():
            i += 1
        if i >= len(lines):
            continue
        image_url = lines[i].strip()
        i += 1

        content_lines = []
        while i < len(lines):
            stripped = lines[i].strip()
            if stripped and not stripped.replace("-", "").replace(":", "").replace(" ", "").isdigit():
                content_lines.append(stripped)
                i += 1
            else:
                break
        content = " ".join(content_lines) if content_lines else "Nessun testo"

        while i < len(lines) and not lines[i].strip():
            i += 1
        if i >= len(lines):
            continue
        update_time = lines[i].strip()
        i += 1

        if not title or not image_url or not update_time:
            continue
        if not image_url.startswith(("http://", "https://")):
            continue

        news_list.append({
            "title": title,
            "image_url": image_url,
            "content": content,
            "update_time": update_time,
            "formatted_time": format_update_time(update_time)
        })

    try:
        news_list.sort(key=lambda x: datetime.strptime(x["update_time"], "%Y-%m-%d %H:%M:%S"), reverse=True)
    except:
        pass

    return news_list

# -------------------------------
# DIALOG / MODAL per notizia completa
@st.dialog("Notizia completa", width="large")
def show_full_news(item):
    st.image(item["image_url"], use_container_width=True)
    st.markdown(f"### {item['title']}")
    st.caption(f"Ultimo aggiornamento: {item['formatted_time']}")
    st.markdown(item["content"])

# -------------------------------
# SIDEBAR: ultimi 7 giorni + calendario
st.sidebar.title("ðŸ“… Navigazione")

today = date.today()

# Ultimi 7 giorni
for offset in range(7):
    day_date = today - timedelta(days=offset)
    weekday_it = WEEKDAYS_IT[day_date.weekday()]
    day_str = day_date.day
    month_it = MONTHS_IT[day_date.month - 1]
    label = f"{weekday_it} {day_str:02d} {month_it}"
    if offset == 0:
        label += " (oggi)"

    if st.sidebar.button(label, use_container_width=True):
        st.session_state.selected_date = day_date

# Calendario per date piÃ¹ vecchie
st.sidebar.markdown("---")
new_date = st.sidebar.date_input("Vai a data specifica", value=today, max_value=today)
if new_date != st.session_state.get("selected_date", today):
    st.session_state.selected_date = new_date

selected_date = st.session_state.get("selected_date", today)

# -------------------------------
# Caricamento notizie
if selected_date == today:
    file_path = "news.txt"
    st_autorefresh(interval=REFRESH_INTERVAL_MS, key="autorefresh_home")
else:
    file_path = os.path.join(ARCHIVE_DIR, selected_date.strftime("%Y%m%d") + ".txt")

news = load_news(file_path)

date_display = "oggi" if selected_date == today else selected_date.strftime("%d/%m/%Y")

# -------------------------------
# INTERFACCIA PRINCIPALE
st.title("Notizie in Sintesi")

if news is None:
    st.info(f"ðŸ“‚ Nessun file trovato per {date_display}.")
    st.caption(f"Controlla che esista: `{file_path}`")
elif not news:
    st.info(f"ðŸ“­ Nessuna notizia valida per {date_display}.")
else:
    max_update_formatted = news[0]["formatted_time"]
    st.caption(f"Ultimo aggiornamento: {max_update_formatted} â€” {date_display}")

    cols = st.columns(3)
    for idx, item in enumerate(news):
        with cols[idx % 3]:
            with st.container(border=True):
                # Immagine con titolo sovrapposto
                st.image(item["image_url"], use_container_width=True)
                st.markdown(
                    f"<div style='position: relative; margin-top: -70px; padding: 8px 12px; background: rgba(0,0,0,0.7); color: white; border-radius: 0 0 8px 8px;'><b>{item['title']}</b></div>",
                    unsafe_allow_html=True
                )

                st.caption(f"Ultimo aggiornamento: {item['formatted_time']}")

                sintesi = item["content"][:280] + ("..." if len(item["content"]) > 280 else "")
                st.markdown(sintesi)

                if st.button("Leggi tutto", key=f"read_{idx}_{selected_date}"):
                    show_full_news(item)

# Footer sidebar
st.sidebar.markdown("---")
st.sidebar.caption("Archivio in /archive")


======================================================================
FILE: archive/20260107.txt
======================================================================

Agente ICE uccide cittadina statunitense durante un controllo
https://www.advocate.com/media-library/ice-agent-shoots-suv-driver.jpg?id=62682217&width=1245&height=700&coordinates=0%2C0%2C0%2C0
Un agente dell'ICE ha ucciso con colpi d'arma da fuoco Renee Nicole Good, 37enne cittadina statunitense, poetessa premiata, madre di tre figli e residente locale con il partner. Good, originaria del Colorado e laureata in inglese, era descritta dalla madre Donna Ganger come una persona Â«estremamente compassionevole, amorevole e straordinariaÂ», sempre pronta ad aiutare gli altri.
L'incidente Ã¨ avvenuto durante la piÃ¹ grande operazione immigratoria federale mai condotta (oltre 2.000 agenti DHS/ICE dispiegati nel Twin Cities, mirata soprattutto alla comunitÃ  somala). Good si trovava nella zona per osservare o proteggere i vicini, forse bloccando la strada con la sua Honda Pilot rossa.
I video verificati da NYT, Guardian e altri media mostrano agenti avvicinarsi al veicolo fermo; Good indietreggia lentamente, poi avanza piano. Un agente spara piÃ¹ volte attraverso il parabrezza, colpendola alla testa. L'auto accelera e si schianta contro veicoli parcheggiati.
Le versioni divergono nettamente: autoritÃ  federali (segretaria DHS Kristi Noem) parlano di legittima difesa, accusando Good di Â«weaponizzareÂ» l'auto per investire agenti (Â«atto di terrorismo domesticoÂ»). Leader locali (sindaco Jacob Frey: Â«Ãˆ bullshitÂ», governatore Tim Walz) e testimoni respingono questa narrazione, definendo il tiro eccessivo e non giustificato; nessun agente risulta gravemente ferito.
Good non era oggetto di indagini. Immediate proteste, veglie con migliaia di persone, cancellazioni scolastiche e tensioni diffuse in altre cittÃ  USA. Indagini FBI in corso.
2026-01-07 17:45:00


=== FINE ===
